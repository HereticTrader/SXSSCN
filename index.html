<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sniffer v10.9 ‚Äî Transparent Candles & COG Boost</title>
  <style>
    body {
      background: black;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .dashboard-row {
      display: flex;
      width: 100%;
      justify-content: space-around;
      margin-top: 10px;
    }
    .chart-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { color: #0ff; }
    canvas {
      border: 1px solid #0f0;
      background: #111;
      display: block;
      margin-top: 10px;
    }
    .notify {
      margin-top: 10px;
      font-weight: bold;
    }
    #speedNumbers {
      font-size: 20px;
      margin-top: 15px;
    }
    .green { color: #0f0; }
    .red { color: #f00; }
    .yellow { color: #ff0; }
    .spark {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>üöó ALCH/USDT ‚Äî Chart Dashboard</h1>
  <div class="chart-wrapper">
    <canvas id="frontWindowChart" width="1000" height="240"></canvas>
    <canvas id="volumeChart" width="1000" height="120"></canvas>
    <canvas id="speedOverlayChart" width="1000" height="100"></canvas>
  </div>

  <div id="speedNumbers">
    üü¢ UTS: <span class="green" id="uptickSpeed">0</span> ‚Äî üî¥ DTS: <span class="red" id="downtickSpeed">0</span> ‚Äî ‚ö° Delta: <span id="deltaSpeed">0</span>
    <span id="sparkDot" class="spark"></span>
  </div>

  <div class="dashboard-row">
    <div class="chart-wrapper">
      <div class="notify" id="speedNotify">‚ö°Ô∏è Speed detection pending...</div>
      <div class="notify" id="liveSpeed">üïí Live Speed Monitor ‚Äî waiting for ticks...</div>
    </div>
  </div>

  <script>
    const frontCtx = document.getElementById("frontWindowChart").getContext("2d");
    const volumeCtx = document.getElementById("volumeChart").getContext("2d");
    const overlayCtx = document.getElementById("speedOverlayChart").getContext("2d");

    const uptickSpeedText = document.getElementById("uptickSpeed");
    const downtickSpeedText = document.getElementById("downtickSpeed");
    const deltaSpeedText = document.getElementById("deltaSpeed");
    const sparkDot = document.getElementById("sparkDot");

    let priceCandles = [];
    let speedData = [];
    const maxFrontCandles = 50;

    let lastPrice = null;
    let upSpeed = 0;
    let downSpeed = 0;

    function drawFrontChart() {
      frontCtx.clearRect(0, 0, 1000, 240);
      if (priceCandles.length < 1) return;

      const w = 1000 / maxFrontCandles;
      const h = 240;
      const max = Math.max(...priceCandles.map(c => c.high));
      const min = Math.min(...priceCandles.map(c => c.low));
      const range = max - min || 1;

      priceCandles.forEach((c, i) => {
        const x = i * w;
        const oY = h - ((c.open - min) / range) * h;
        const cY = h - ((c.close - min) / range) * h;
        const hY = h - ((c.high - min) / range) * h;
        const lY = h - ((c.low - min) / range) * h;
        const gravity = (c.high + c.low + c.close) / 3;
        const gravityY = h - ((gravity - min) / range) * h;

        const color = c.close >= c.open ? "rgba(0,255,0,0.5)" : "rgba(255,0,0,0.5)";
        frontCtx.strokeStyle = color;
        frontCtx.beginPath();
        frontCtx.moveTo(x + w / 2, hY);
        frontCtx.lineTo(x + w / 2, lY);
        frontCtx.stroke();

        frontCtx.fillStyle = color;
        frontCtx.fillRect(x + 1, Math.min(oY, cY), w - 2, Math.abs(oY - cY));

        frontCtx.fillStyle = "#00ffff";
        frontCtx.beginPath();
        frontCtx.arc(x + w / 2, gravityY, 3, 0, 2 * Math.PI);
        frontCtx.fill();
      });

      frontCtx.fillStyle = "#0ff";
      frontCtx.font = "12px monospace";
      frontCtx.fillText(`Price: ${priceCandles[priceCandles.length - 1].close.toFixed(5)}`, 910, 20);
    }

    function drawVolumeChart() {
      volumeCtx.clearRect(0, 0, 1000, 120);
      const w = 1000 / maxFrontCandles;
      const h = 120;
      const maxVol = Math.max(...priceCandles.map(c => c.volume || 1));
      priceCandles.forEach((c, i) => {
        const x = i * w;
        const vHeight = (c.volume || 1) / maxVol * h;
        const color = c.close >= c.open ? "rgba(0,255,0,0.5)" : "rgba(255,0,0,0.5)";
        volumeCtx.fillStyle = color;
        volumeCtx.fillRect(x + 1, h - vHeight, w - 2, vHeight);
      });
    }

    function drawSpeedOverlay() {
      overlayCtx.clearRect(0, 0, 1000, 100);
      const w = 1000 / speedData.length;
      const h = 100;
      speedData.forEach((s, i) => {
        const x = i * w;
        const yU = h - s.up * 1000000;
        const yD = h - s.down * 1000000;

        overlayCtx.beginPath();
        overlayCtx.arc(x, yU, 2, 0, 2 * Math.PI);
        overlayCtx.fillStyle = "#0f0";
        overlayCtx.fill();

        overlayCtx.beginPath();
        overlayCtx.arc(x, yD, 2, 0, 2 * Math.PI);
        overlayCtx.fillStyle = "#f00";
        overlayCtx.fill();
      });
    }

    const tradeSocket = new WebSocket("wss://fstream.binance.com/ws/alchusdt@trade");
    tradeSocket.onmessage = (event) => {
      const d = JSON.parse(event.data);
      const price = parseFloat(d.p);
      const vol = parseFloat(d.q);

      if (lastPrice !== null) {
        const diff = price - lastPrice;
        const abs = Math.abs(diff);
        const dt = 100;
        if (diff > 0) upSpeed = abs / dt;
        else if (diff < 0) downSpeed = abs / dt;
      }
      lastPrice = price;
    };

    setInterval(() => {
      speedData.push({ up: upSpeed, down: downSpeed });
      if (speedData.length > maxFrontCandles) speedData.shift();

      const delta = (upSpeed - downSpeed) * 100000;
      uptickSpeedText.textContent = (upSpeed * 100000).toFixed(2);
      downtickSpeedText.textContent = (downSpeed * 100000).toFixed(2);
      deltaSpeedText.textContent = delta.toFixed(2);
      deltaSpeedText.className = delta > 0 ? "green" : delta < 0 ? "red" : "yellow";

      sparkDot.style.background = delta > 0.05 ? "#0f0" : delta < -0.05 ? "#f00" : "#222";

      drawSpeedOverlay();
    }, 1000);

    const klineSocket = new WebSocket("wss://fstream.binance.com/ws/alchusdt@kline_1m");
    klineSocket.onmessage = (event) => {
      const d = JSON.parse(event.data).k;
      const candle = {
        open: parseFloat(d.o),
        high: parseFloat(d.h),
        low: parseFloat(d.l),
        close: parseFloat(d.c),
        volume: parseFloat(d.v)
      };
      priceCandles.push(candle);
      if (priceCandles.length > maxFrontCandles) priceCandles.shift();
      drawFrontChart();
      drawVolumeChart();
    };
  </script>
</body>
</html>
