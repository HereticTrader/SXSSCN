<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sniffer v5.0 — ALCH/USDT Candles</title>
  <style>
    body {
      background: black;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    h1 { color: #0ff; }
    .section-title {
      margin-top: 20px;
      color: #0ff;
      font-weight: bold;
    }
    canvas {
      border: 1px solid #0f0;
      background: #111;
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ALCH/USDT Sniffer v5.0 — Candles Only</h1>
  <div class="section-title">📈 Price Candles (1m)</div>
  <canvas id="priceCanvas" width="800" height="200"></canvas>

  <script>
    const priceCanvas = document.getElementById("priceCanvas");
    const ctxPrice = priceCanvas.getContext("2d");

    let candles = [];
    const maxLen = 12; // Only 12 candles visible

    let glowMarkers = []; // Track timestamps of glow events

    // 🛱️ Candle Data
    const klineSocket = new WebSocket("wss://fstream.binance.com/ws/alchusdt@kline_1m");

    klineSocket.onmessage = (event) => {
      const data = JSON.parse(event.data).k;
      const open = parseFloat(data.o);
      const high = parseFloat(data.h);
      const low = parseFloat(data.l);
      const close = parseFloat(data.c);

      candles.push({ open, high, low, close, timestamp: Date.now() });
      glowMarkers.push(Date.now());

      if (candles.length > maxLen) candles.shift();
      if (glowMarkers.length > maxLen) glowMarkers.shift();

      drawCandles();
    };

    // 🔧 Draw Candles
    function drawCandles() {
      ctxPrice.clearRect(0, 0, priceCanvas.width, priceCanvas.height);
      const w = priceCanvas.width / maxLen;
      const h = priceCanvas.height;
      const prices = candles.flatMap(c => [c.high, c.low]);
      const max = Math.max(...prices);
      const min = Math.min(...prices);
      const range = max - min || 1;

      candles.forEach((c, i) => {
        const x = i * w;
        const oY = h - ((c.open - min) / range) * h;
        const cY = h - ((c.close - min) / range) * h;
        const hY = h - ((c.high - min) / range) * h;
        const lY = h - ((c.low - min) / range) * h;

        const color = c.close >= c.open ? "#0f0" : "#f00";
        ctxPrice.strokeStyle = color;
        ctxPrice.beginPath();
        ctxPrice.moveTo(x + w / 2, hY);
        ctxPrice.lineTo(x + w / 2, lY);
        ctxPrice.stroke();

        ctxPrice.fillStyle = color;
        ctxPrice.fillRect(x + 1, Math.min(oY, cY), w - 2, Math.abs(oY - cY));

        // 🔋 Glow pulse
        const age = Date.now() - c.timestamp;
        if (age < 500) {
          const glowAlpha = 1 - age / 500;
          ctxPrice.beginPath();
          ctxPrice.arc(x + w / 2, hY - 5, 5, 0, 2 * Math.PI);
          ctxPrice.fillStyle = `rgba(0, 255, 255, ${glowAlpha})`;
          ctxPrice.fill();
        }
      });

      requestAnimationFrame(drawCandles);
    }
  </script>
</body>
</html>
