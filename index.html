<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sniffer v6.1 ‚Äî Speed & Levels</title>
  <style>
    body {
      background: black;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    h1 { color: #0ff; }
    .section-title {
      margin-top: 20px;
      color: #0ff;
      font-weight: bold;
    }
    canvas {
      border: 1px solid #0f0;
      background: #111;
      display: block;
      margin-top: 10px;
    }
    .notify {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ALCH/USDT ‚Äî Real-Time Pulse Candles</h1>
  <div class="section-title">üìà Live Evolving Candles (1m)</div>
  <canvas id="priceCanvas" width="800" height="200"></canvas>
  <div class="notify" id="speedNotify">‚ö°Ô∏è Speed detection pending...</div>

  <script>
    const priceCanvas = document.getElementById("priceCanvas");
    const ctx = priceCanvas.getContext("2d");
    const notify = document.getElementById("speedNotify");
    const maxCandles = 12;
    const candleDuration = 60 * 1000; // 1 minute

    let candles = [];
    let currentCandle = null;
    let candleStart = Date.now();
    let lastPrice = null;
    let upTicks = 0, downTicks = 0;

    const tradeSocket = new WebSocket("wss://fstream.binance.com/ws/alchusdt@trade");

    tradeSocket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const price = parseFloat(data.p);
      const now = Date.now();

      if (!currentCandle || now - candleStart >= candleDuration) {
        if (currentCandle) {
          candles.push(currentCandle);
          if (candles.length > maxCandles) candles.shift();
        }
        currentCandle = { open: price, high: price, low: price, close: price };
        candleStart = now;

        // Evaluate tick speeds
        const verdict = upTicks > downTicks ? "üîº Upticks DOMINATE" : downTicks > upTicks ? "üîΩ Downticks DOMINATE" : "‚ö°Ô∏è Even Speed";
        notify.textContent = `‚öñÔ∏è Current Candle Speed ‚Äî ${verdict}`;

        upTicks = 0;
        downTicks = 0;
      } else {
        currentCandle.high = Math.max(currentCandle.high, price);
        currentCandle.low = Math.min(currentCandle.low, price);
        currentCandle.close = price;
      }

      if (lastPrice !== null) {
        if (price > lastPrice) upTicks++;
        else if (price < lastPrice) downTicks++;
      }
      lastPrice = price;

      drawCandles();
    };

    function drawCandles() {
      ctx.clearRect(0, 0, priceCanvas.width, priceCanvas.height);
      const w = priceCanvas.width / maxCandles;
      const h = priceCanvas.height;

      const full = [...candles, currentCandle];
      const prices = full.flatMap(c => [c.high, c.low]);
      const max = Math.max(...prices);
      const min = Math.min(...prices);
      const range = max - min || 1;

      // Gridlines for price levels
      ctx.strokeStyle = "#333";
      ctx.lineWidth = 0.5;
      for (let i = 0; i <= 5; i++) {
        const y = i * (h / 5);
        const priceLevel = max - (range * i / 5);
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(priceCanvas.width, y);
        ctx.stroke();

        ctx.fillStyle = "#0ff";
        ctx.fillText(priceLevel.toFixed(4), 5, y + 10);
      }

      full.forEach((c, i) => {
        const x = i * w;
        const oY = h - ((c.open - min) / range) * h;
        const cY = h - ((c.close - min) / range) * h;
        const hY = h - ((c.high - min) / range) * h;
        const lY = h - ((c.low - min) / range) * h;

        const color = c.close >= c.open ? "#0f0" : "#f00";
        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.moveTo(x + w / 2, hY);
        ctx.lineTo(x + w / 2, lY);
        ctx.stroke();

        ctx.fillStyle = color;
        ctx.fillRect(x + 1, Math.min(oY, cY), w - 2, Math.abs(oY - cY));
      });
    }
  </script>
</body>
</html>
